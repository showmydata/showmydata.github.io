---
layout: post
title: "栈初步"
categories: 
  - Notes
tags:
  - Pwn
last_modified_at: 2022-03-18T22:00:52+08:00
---

## 函数调用栈

> 关于栈，有很多内容，可以参考CTF_Wiki或其它资料，这里对初学者部分必须了解的内容进行总结

**EBP和ESP**

- EBP是栈帧基址指针寄存器，是栈一开始的高地址基址
- ESP是堆栈指针寄存器，初始位于EBP位置，之后随着数据入栈，向低地址增长，也就是每次入栈都会导致ESP减小
- 关于堆栈的特点，后进先出，之类的内容数据结构课程中已经有所了解
- EBP和ESP中间就是数据了，这里存储着我们定义的局部变量等，具体的地址分配方式由编译器决定，比较复杂，初学可以先略过，一般不会用到

**函数返回地址**

- 函数返回地址在EBP相邻的高地址上，可以说EBP“往上”紧挨着Return address

**函数参数**

- 对于32位系统，x86
  - 函数参数在函数返回地址的上方，也就是相邻的高地址

- 对于64位系统，x64
  - System V AMD64 ABI(Linux、FreeBSD、macOS等采用)
    - 函数参数中，前6个整型或指针参数依次保存在
    - RDI，RSI，RDX，RCX，R8，R9寄存器中
    - 如果由更多的参数的话才会保存在栈上
  - 内存地址不能大于0x00007FFFFFFFFFFF，6个字节长度，否则会抛出异常