---
layout: post
title: "2022春-计网-第7讲"
categories: 
  - Courses
tags:
  - 课程学习
  - 计算机网络
last_modified_at: 2022-03-16T22:10:52+08:00u
---

## 可靠数据传输

**可靠数据传输协议（rdt）**

- 基本结构：接口
  - rdt_send()：被上层应用调用，将数据交给rdt以发送给对方
  - udt_send()：被rdt调用，在不可靠信道上向接收方传输数据
  - delever_data()：被rdt调用，向上层应用交付数据
  - rdt_rcv()：当数据包到达接收方信道时被调用
- 渐进地设计可靠数据传输协议的发送方和接收方
- 只考虑单向数据传输，但控制信息双向流动
- 利用状态机（Finite State Machine，FSM）刻画传输协议

**Rdt1.0：可靠信道上的可靠数据传输**

- 底层信道完全可靠
  - 不会发生错误（bit error）
  - 不会丢弃分组
- 发送方和接收方的FSM独立，一个只管发送，一个只管接收

**Rdt2.0：产生位错误的信道**

- 底层信道可能翻转分组中的位（bit）
  - 利用校验和检测位错误
- 从错误中恢复
  - 确认机制（Acknowledgements，ACK）：接收方显式地告知发送方分组已接收
  - NAK：接收方显示地告知发送方分组有错误
  - 发送方收到NAK后，**重传分组**
- 基于这种重传机制的rdt协议称为ARQ（Automatic Repeat Request）协议
- Rdt2.0中引入的新机制：
  - 差错检测
  - 接收方反馈控制消息：ACK/NAK
  - 重传
- 缺陷：
  - 如果ACK/NAK消息发生错误/被破坏
    - 为ACK/NAK添加校验和，检错并纠错
    - 如果坏掉，发送方重传
    - 不能简单的重传，会产生重复分组
  - 如何解决重复分组的问题
    - 为每个分组增加序列号

**Rdt2.1：应对ACK/NAK破坏**

- 发送方

  - 为每个分组添加了序列号

  - 两个序列号（0，1）就够用

  - 需检验ACK/NAK消息是否发生错误

  - 状态数量翻倍，必须记住当前的分组序列号

- 接收方

  - 需判断分组是否重复，当前所处状态提供了期望收到分组的序列号
  - 接收方无法指导ACK/NAK是否被发送方正确收到

**Rdt2.2：无NAK消息协议**

- 与rdt2.1功能相同，只使用ACK
- 在ACK消息中显式地加入被确认分组的序列号
- 发送方收到重复ACK后，采取与收到NAK消息相同的动作
  - 重传当前分组

**Rdt3.0**

- 发送方等待“合理”时间
  - 如果没收到ACK，重传
  - 如果分组或ACK只是延迟而不是丢了
    - 重传会产生重复，序列号机制能够处理
    - 接收方需在ACK中显式告知所确认的分组
  - 需要计时器
- 能够正常工作，但性能很差
- 网络协议限制了物理资源的利用

**停-等协议**

- Rdt3.0的核心就是停-等操作
- 信道利用率
  - $t_{seg}=\frac{L}{R}$，L是分组长度，R是传输速率，$t_{seg}$是传输分组的时间
  - $U{stop-wait}=\frac{t_{seg}}{t_{seg}+RTT+t_{ACK}}$
- 流水线机制可以提高资源利用率
  - 允许发送方在收到ACK之前连续发送多个分组
  - 发送方和/或接收方需要更大的存储空间以缓存分组

**滑动窗口协议**

- Sliding-window protocal
- 窗口
  - 允许使用的序列号范围
  - 窗口尺寸为N：最多有N个等待确认的消息
- 滑动窗口
  - 随着协议的运行，窗口在序列号空间内向前滑动
- 滑动窗口协议：GBN，SR
- 信道利用率
  - $U=\frac{W_s\times t_{seg}}{t_{seg}+RTT+t_{ACK}}=\frac{W_s\times L/R}{L/R+2d_p+L^{'}/R}=\frac{W_s\times L}{L+2d_pR+L^{'}}$
  - 其中，$d_p$是端到端延迟

**GBN协议（Go-Back-N）**

- 发送方

  - 窗口尺寸为N，最多允许N个分组未确认

  - ACK：确认到序列号n（包含n）的分组均已被正确接收
    - 累积确认，可能收到重复ACK

  - 为空中的分组设置计时器（timer）

  - 超时Timeout(n)事件：重传序列号大于等于n，还未收到ACK的所有分组

- 接收方

  - ACK机制：发送拥有最高序列号的、已被正确接收的分组的ACK
    - 可能产生重复ACK
    - 只需要记住唯一的期望序号expectedseqnum，即$W_R=1$
  - 乱序到达的分组：
    - 直接丢弃，接收方对其不缓存
    - 重新确认序列号最大的、按序到达的分组

**SR协议（Selective Repeat）**

- 接收方对每个分组单独进行确认
  - 设置缓存机制，缓存乱序到达的分组
- 发送方只重传那些没接收到ACK的分组
  - 为每个分组设置定时器
- 发送方窗口
  - N个连续的序列号
  - 限制已发送且未确认的分组
- 窗口大小与序列号的约束条件
  - $W_s+W_r \le 2^k$
  - 对于GBN协议，$W_r=1$
    - $W_s\le 2^k-1$
  - 对于典型的$W_s=W_r=W的SR协议$
    - $W_s\le 2^{k-1}$
  - 对于停-等协议，即$W_s=W_r=1$
    - $k\ge 1$

**滑动窗口协议的窗口大小**

- 窗口大小影响性能：
  - 信道利用率
  - 吞吐率
- 影响窗口大小的因素
  - 序号空间
  - 缓存大小
  - 流量控制
  - 拥塞控制

---

## 多路访问控制协议

> 两个或两个以上结点同时传输：
>
> 干扰、冲突：结点同时接收到两个或者多个信号，接收失败

**多路访问控制协议**

- 采用分布式算法决定结点如何共享信道，即决策结点何时可以传输数据
- 必须基于信道本身，通信信道共享协调信息

**理想MAC协议**

- 给定：速率位R bps的广播信道
- 期望：
  - 当只有一个结点希望传输数据时，以R bps的速率发送
  - 当有M个界定啊期望发送数据时，每个结点平均发送数据的平均速率是R/M
  - 完全分散控制：无需特定结点协调；无需时钟、时隙同步
  - 简单
- 三类：
  - 信道划分（channel partitioning）MAC协议
    - 多路复用技术
  - 随机访问（random access）MAC协议
    - 信道不划分，允许冲突
    - 采用冲突“恢复”机制
  - 轮转（“taking turns”）MAC协议
    - 结点轮流使用信道

**信道划分MAC协议**

- TDMA
  - time division multiple access
  - 周期性接入信道，占用固定的时隙
- FDMA
  - frequency division multiple access
  - 信道频谱划分位若干频带，每个站点分配一个固定的频带

**随机访问MAC协议**

- 需要定义
  - 如何检测冲突
  - 如何从冲突中恢复
- 典型的随机访问MAC协议
  - 时隙（sloted）ALOHA
  - ALOHA
  - CSMA、CSMA/CD、CSMA/CA
