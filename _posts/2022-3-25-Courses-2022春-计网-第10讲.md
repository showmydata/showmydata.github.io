---
layout: post
title: "2022春-计网-第10讲"
categories: 
  - Courses
tags:
  - 课程学习
  - 计算机网络
last_modified_at: 2022-03-25T22:10:52+08:00u
---

### 网络层

#### 网络层概述

- 从发送主机向接收主机传送数据段（segment）
- 发送主机：将数据段封装到数据报（datagram）中
- 接收主机：向传输层交付数据段（segment）
- 每个主机和路由器都运行网络层协议
- 路由器检验所有穿越它的IP数据报的头部域
  - 决策如何处理IP数据报

#### 网络层核心功能

- 转发与路由
  - 转发：将分组从路由器的输入端口转移到合适的输出端口
  - 路由：确定分组从源到目的经过的路
- 连接建立
  - 数据分组传输之前两端主机需要首先建立虚拟/逻辑连接
    - 网络设备（如路由器）参与连接的建立
  - 网络层连接与传输层连接的对比
    - 网络层连接：两个主机之间（路径上的路由器等网络设备参与其中）
    - 传输层连接：两个应用进程之间（对中间网络设备透明）
- 拥塞控制

#### 网络层服务模型

- 无连接服务
  - 不事先为系列分组的传输确定传输路径
  - 每个分组独立确定传输路径
  - 不同分组可能传输路径不同
  - 数据报网络
- 有连接服务
  - 首先为系列分组的传输确定从源到目的经过的路径（建立连接）
  - 然后沿该路径（连接）传输系列分组
  - 系列分组传输路径相同

#### 拥塞控制

- 拥塞：太多发送主机发送了太多数据或者发送速度太快，以至于网络无法处理
  - 表现：
    - 分组丢失（路由器缓存溢出）
    - 分组延迟过大（在路由器缓存中排队）
- 拥塞控制vs流量控制
  - 拥塞控制：针对整个网络
  - 流量控制：针对对应主机
- 拥塞的代价
  - 对给定的good put，要做更多的工作（重传），造成资源的浪费
  - 分组延迟太大
  - 当分组呗丢弃时，任何用于该分组的“上游”传输能力全部被浪费掉
- 拥塞控制的方法
  - 传输层端到端拥塞控制
    - 网络层不需要显式地提供支持
    - 端系统通过观察loss，delay等网络行为判断是否发生拥塞
    - TCP采取这种方法
  - 网络层（辅助）拥塞控制
    - 路由器向发送方显式地反馈网络拥塞信息
    - 简单的拥塞指示：SNA，DECbit，TCP/IP ECN，ATM
    - 指示发送方应该采取何种速率

- 网络层拥塞控制策略
  - 流量感知路由
  - 准入控制
  - 流量调节
    - 抑制分组：降低源主机发送速率
    - 背压：向之前的路由器反馈拥塞信息
  - 负载脱落
    - 丢弃数据（根据优先级）

- 案例：ATM ABR拥塞控制
  - ABR：availabel bit rate
    - 弹性服务
    - 如果发送方路径“underloaded”，使用可用带宽
    - 如果发送方路径拥塞，将发送速率降到最低保障速率
  - RM（resource management） cells
    - 信元
    - 发送方发送
    - 交换机设置RM cell位（网络辅助）
      - NI bit：速率不许增长
      - CI bit：拥塞指示
    - RM cells由接收方返回给发送方
  - 在RM cell中由显式的速率（ER）字段：两个字节
    - 拥塞的交换机可以将ER值置为更低的值
    - 发送方获知路径所能支持的最小速率
  - 数据cell中的EFCI位：
    - 拥塞的交换机将其设为1
    - 如果RM cell前面的data cell的EFCI位被设为1，那么发送方在返回的RM cell中置CI位

###虚电路网络与数据报网络

#### 连接服务与无连接服务

- 数据报网络与虚电路网络是典型的两类分组交换网络
- 数据报网络提供网络层无连接服务
- 虚电路网络提供网络层连接服务
- 类似于传输层的无连接服务（UDP）和面向连接服务（TCP）
  - 但是网络层服务：主机到主机服务、网络核心实现

#### 虚电路

- 一条从源主机到目的主机，类似于电路的路径（逻辑连接）
  - 分组交换
  - 每个分组的传输利用链路的全部带宽
  - 源到目的路径经过的网络层设备共同完成虚电路功能
- 通信过程
  - 呼叫建立 --> 数据传输 --> 拆除呼叫
- 每个分组携带虚电路标识（VC ID），而不是目的主机地址
- 虚电路经过的每个网络设备（如路由器），维护每条经过它的虚电路连接状态
- 链路、网络设备资源（如带宽、缓存等）可以面向VC进行预分配
  - 预分配资源=可预期服务性能
  - 如ATM的电路仿真（CBR）

####　VC的具体实现

- 每条虚电路包括
  - 从源主机到目的主机的一条路径
  - 虚电路号（VCID）
  - 沿路每个网络层设备，利用转发表记录经过的每条虚电路
- 沿某条虚电路传输的分组，携带对应虚电路的VCID，而不是目的地址
- 同一条VC，在每段链路上的VCID通常不同
  - 路由器转发分组时依据转发表改写/替换虚电路号

#### 虚电路信令协议

- 用于VC的建立、维护与拆除
  - 路径选择
- 应用于虚电路网络
  - 如ATM、帧中继网络等
- 目前的Internet不采用

#### 数据报网络

- 网络层无连接
- 每个分组携带目的地址
- 路由器根据分组的目的地址转发分组
  - 基于路由协议/算法构建转发表
  - 检索转发表
  - 每个分组独立选路

#### 数据报转发表

- 路由算法（协议）确定通过网络的端到端路径
- 转发表确定在本路由器如何转发分组
- 目的地址：IP地址（是一个目的地址范围），地址范围划分
- 若地址范围划分不太完美
  - 最长前缀匹配有限
    - 在检索转发表时，优先选择与分组目的地址匹配前缀最长的入口

#### 数据报网络 vs VC网络

- Internet（数据报网络）
  - 计算机之间的数据交换
    - 弹性服务，没有严格时间需求
  - 链路类型众多
    - 特点、性能各异
    - 统一服务困难
  - “智能”端系统（计算机）
    - 可以自适应、性能控制、差错恢复
  - 简化网络，复杂”边缘“

- ATM（VC网络）
  - 电话网络演化而来
  - 核心业务是实时对话：
    - 严格的时间、可靠性需求
    - 需要有保障的服务
  - “哑（dumb）”端系统（非智能）
    - 电话机
    - 传真机
  - 简化”边缘“，复杂网络
