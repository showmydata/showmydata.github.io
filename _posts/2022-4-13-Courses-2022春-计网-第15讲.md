---
layout: post
title: "2022春-计网-第15讲"
categories: 
  - Courses
tags:
  - 课程学习
  - 计算机网络
last_modified_at: 2022-04-13T22:10:52+08:00u
---

#### 互连的AS

- 转发表由AS内部路由算法与AS间路由算法共同配置

  - AS内部路由算法设置AS内部目的网络路由入口
  - AS内部路由算法与AS间路由算法共同设置AS外部目的网络路由入口

  - Intra-AS，Inter-AS

#### 自治系统间（Inter-AS）路由任务

- 假设AS1内某路由器收到一个目的地址在AS1之外的数据报
  - 路由器应该将该数据报转发给哪个网关路由器？
- AS1必须
  - 学习到哪些目的网络可以通过AS2到达，哪些可以通过AS3到达
  - 将这些网络可达性信息传播给AS1内部路由器
- 热土豆路由
  - 将分组发送给最近的网关路由器

### 路由协议

#### AS内部路由

- Internet采用层次路由
- AS内部路由协议也称为内部网络协议IGP
- 最常见的AS内部路由协议
  - 路由信息协议：RIP（routing information protocol）
  - 开放最短路径优先：OSPF（open shortest path first）
  - 内部网关路由协议：IGRP（Interior gateway routing protocol）
    - Cisco私有协议

#### RIP协议

- 早于1982年随BSD-UNIX操作系统发布
- 距离向量路由算法
  - 距离度量：跳步数（max=15 hops），每条链路1个跳步
  - 每隔30s，邻居之间交换一次DV，称为通告
  - 每次通告：最多25个目的子网（IP地址形式）
- 链路失效、恢复
  - 如果180s没有收到通告，邻居/链路失效
  - 经过该邻居的路由不可用
    - 重新计算路由
  - 向邻居发送新的通告
  - 邻居再一次向外发送通告（如果转发表改变）
  - 链路失效信息不能快速传播到全网
    - 无穷计数，毒性逆转
- RIP路由表的处理
  - RIP路由表利用route-d的应用层进程进行管理
  - 通告报文周期性地通过UDP数据报发送

#### OSPF

- 开放：公众可用
- 采用链路状态路由算法
  - LS分组扩展（通告）
  - 每个路由器构造完整的网络（AS）拓扑图
  - 利用Dijkstra算法计算路由
- OSPF通告中每个入口对应一个邻居
- OSPF通告再整个AS范围泛洪
  - OSPF报文直接封装到IP数据报中
- 与OSPF极其相似的一个路由协议：IS-IS路由协议

- 优点（RIP不具备）
  - 安全：所有OSPF报文可以被认证
  - 允许多条相同费用的路径
  - 对于每条链路，可以针对不同的TOS设置多个不同的费用度量
  - 集成单播路由与多播路由
    - 多播OSPF协议（MOSPF）与OSPF利用相同的网络拓扑数据
  - OSPF支持对大规模AS分层

- 分层的OSPF
  - 两级分层：局部区、主干区
    - 链路状态通告只限于区内
    - 每个路由器掌握所在区的详细拓扑
    - 只知道去往其它区网络的“方向”（最短路径）
  - 区边界路由器：
    - 汇总到达所在区网络的距离，通告给其它区边界路由器
  - 主干路由器：
    - 在主干区内运行OSPF路由算法
  - AS边界路由器：连接其它AS

#### Internet AS间路由协议：BGP

- 边界网关协议：事实上的标准域间路由协议
  - 将Internet“粘合”为一个整体的关键
- BGP为每个AS提供了一种手段：
  - eBGP：从邻居AS获取子网可达性信息
  - iBGP：向所有AS内部路由器传播子网可达性信息
  - 基于可达性信息与策略，确定到达其它网络的“好”路径

- BGP基础
  - BGP会话：
    - 两个BGP路由器（”Peers“）交换BGP报文
    - 通告去往不同目的前缀的路径
    - 报文交换基于半永久的TCP连接
  - BGP报文：
    - OPEN：与peer建立TCP连接，并认证发送方
    - UPDATE：通告新路径（或撤销原路径）
    - KEEPALIVE：在无UPDATE时，保活连接；也用于对OPEN请求的确认
    - NOTIFICATION：报告先前报文的差错，也被用于关闭连接
  - 当路由器获得新的前缀可达性时，即在其转发表中增加关于该前缀的入口（路由项）
- 路径属性与BGP路由
  - 通告的前缀信息包括BGP信息
    - 前缀+属性=“路由”
  - 两个重要属性
    - AS-PATH（AS路径）
    - NEXT-HOP（下一跳）
      - 可能从当前AS到下一跳AS存在多条链路
- BGP路由选择
  - 网关路由器收到路由通告后，利用其输入策略决策接收/拒绝该路由
    - 基于策略路由
  - 路由器可能获知到达某目的AS的多条路由，基于以下准则选择
    - 本地偏好值属性：策略决策
    - 最短AS-PATH
    - 最近NEXT-HOP路由器：热土豆路由
    - 附加准则
- 桩网络-只与一个其它AS相连
- 双宿网络-连接两个其它AS

- 提供商网络期望只路由去往/来自其客户的流量

- AS内与AS间路由协议
  - 策略
    - inter-AS：期望能够管理控制流量如何被路由，谁路由经过其网络
    - intra-AS：单一管理，无需策略决策
  - 规模
    - 层次路由节省路由表大小，减少路由表更新流量
    - 适应大规模互联网
  - 性能
    - intra-AS：侧重性能
    - inter-AS：策略主导
