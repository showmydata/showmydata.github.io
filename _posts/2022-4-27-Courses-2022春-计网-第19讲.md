---
layout: post
title: "2022春-计网-第19讲"
categories: 
  - Courses
tags:
  - 课程学习
  - 计算机网络
last_modified_at: 2022-04-27T22:10:52+08:00u
---

### 网络应用体系结构

#### C/S架构

- 客户机/服务器结构
- 服务器
  - 7*24小时提供服务
  - 永久性可访问地址/域名
  - 利用大量服务器实现可扩展性
- 客户机
  - 与服务器通信，使用服务器提供的服务
  - 间歇性接入网络
  - 可能使用动态IP地址
  - 不会与其它客户机直接通信

#### P2P架构

- 点对点结构
- 没有永远在线的服务器
- 任意端系统/结点之间可以直接通讯
- 结点间歇性接入网络
- 系欸但可能改变IP地址
- 优点：高度可伸缩
- 缺点：难于管理

#### Hybrid架构

- 混合结构
- Napster
  - 文件传输使用P2P结构
  - 文件的搜索采用C/S结构——集中式
    - 每个结点向中央服务器登记自己的内容
    - 每个结点向中央服务器提交查询请求，查找感兴趣的内容

### 网络应用通信原理

####网络应用的基础：进程间通信

- 进程：主机上运行的程序
- 客户机进程：发起通信的进程
- 服务器进程：等待通信请求的进程
- 同一主机上运行的进程间通信
  - 进程间通信机制
  - 操作系统提供
- 不同主机上运行的进程间通信
  - 消息交换

#### 套接字：Socket

- 进程间通信利用socket发送/接收消息实现
- 过程类似于寄信，socket套接字是邮箱
  - 发送方将消息送到门外邮箱
  - 发送方依赖传输基础设施将消息传到接收方所在主机，并送到接收方
  - 接收方从邮箱获取消息
- 传输基础设施向进程提供API
  - 传输协议的选择
  - 参数的设置

#### 进程寻址

- 不同主机上的进程间通信 
  - 每个进程必须拥有标识符
  - 标识符 = IP地址 + 端口号
- 寻址主机：IP地址
- 区分进程：端口号
- 端口号：为每个需要通信的进程分配一个端口号
  - HTTP Server：80
  - Mail Server：25

#### 应用层协议

- 网络应用需遵循应用层协议
  - 公开协议
    - 由RFC(Request For Comments)定义
    - 允许互操作
    - HTTP，SMTP，...
  - 私有协议
    - 多数P2P文件共享应用

#### 应用层协议的内容

- 消息的类型
  - 请求消息
  - 相应消息
- 消息的语法/格式
  - 消息中的字段及字段如何描述
- 字段的语义
  - 字段中信息的含义
- 规则
  - 进程何时发送/响应消息
  - 进程如何发送/响应消息

#### 网络应用对传输服务的需求

- 数据丢失/可靠性
  - 某些网络应用能够容忍一定的数据丢失：网络电话
  - 某些要求100%可靠的数据传输：文件传输，telnet
- 时间/延迟
  - 有些应用只有在延迟足够低时才"有效"
  - 网络电话/网络游戏
- 带宽
  - 某些应用只有在带宽达到最低要求时才"有效"：网络视频
  - 某些应用能适应任何带宽：弹性应用：email

#### Internet提供的传输服务

| 服务          | TCP      | UDP    |
| ------------- | -------- | ------ |
| 连接          | 面向连接 | 无连接 |
| 传输          | 可靠     | 不可靠 |
| 流量控制      | 提供     | 不提供 |
| 拥塞控制      | 提供     | 不提供 |
| 时间/延迟保障 | 不提供   | 不提供 |
| 最小带宽保障  | 不提供   | 不提供 |

### 域名解析系统（DNS）

#### DNS：Domain Name System

- Internet上主机/路由器的识别问题
  - 域名和IP地址的映射
- 多层命名服务器构成的**分布式**数据库
- 应用层协议：完成名字的解析
  - Internet核心功能，用应用层实现
  - 网络边界复杂
- DNS服务
  - 域名向IP地址的翻译
  - 主机别名
  - 邮件服务器别名
  - 负载均衡：Web服务器
- 不使用集中式的DNS
  - 单点失败问题
  - 流量问题
  - 距离问题
  - 维护性问题

#### DNS-域名层次结构

- 根服务器
- .edu是顶级域名，.edu.cn是二级域名
- 例如，客户端查询www.amazon.com的IP
  - 客户端查询根服务器，找到com域名解析服务器
  - 客户端查询com域名解析服务器，找到amazon.com域名解析服务器
  - 客户端查询amazon.com域名解析服务器，获得www.amazon.com的IP地址
- 本地域名解析服务器无法解析域名时，访问根域名服务器
  - 全球有13个根域名服务器

#### 域名解析服务器

- TLD顶级域名服务器
  - 负责顶级域名和国家顶级域名
- 权威域名服务器
  - 组织的域名解析服务器，提供组织内部服务器的解析服务
  - 组织负责维护
  - 服务提供商负责维护
- 本地域名解析服务器
  - 不严格属于层级体系
  - 每个ISP有一个本地域名服务器
    - 默认域名解析服务器
  - 当主机进行DNS查询时，查询被发送到本地域名服务器
    - 作为代理，将查询转发给层级式域名解析服务器系统

#### DNS查询过程

- 递归查询
  - 查询
  - 本地域名服务器
  - 根域名服务器
  - 顶级域名服务器
  - 权威域名服务器
  - 再依次返回
- 迭代查询
  - 查询
  - 本地域名服务器
  - 根域名服务器，返回顶级域名服务器IP地址
  - 顶级域名服务器，返回权威域名服务器IP地址
  - 权威域名服务器，返回IP地址

#### DNS记录缓存和更新

- 只要域名解析服务器获得域名-IP映射，就缓存这一映射
  - 一段时间过后，缓存条目失效，即删除
  - 本地域名服务器一般会缓存顶级域名服务器的映射
    - 因此根域名服务器不经常被访问
- 记录的更新/通知机制
- DNS记录
  - 资源记录(RR, resource, records)
  - RR format：(name, value, type, ttl)
    - type=A
      - Name：主机域名
      - Value：IP地址
    - type=NS
      - Name：域(edu.cn)
      - Value：该域权威域名解析服务器的主机域名
    - type=CNAME
      - Name：某一真实域名的别名
      - Value：真实域名
    - type=MX
      - Value是与Name(别名)相对应的邮件服务器

#### DNS协议与消息

- DNS协议
  - 查询和回复
  - 消息格式相同
- 消息头部
  - Identification：16位查询编号，回复使用相同的编号
  - flags：查询或回复；期望递归；递归可用；权威回答
  - questions：Name，type
  - answers：RRs
  - autority：records for autohritative servers
  - additional information：additional "helpful" info 

#### 注册域名

- 例如，创建某公司"Network Utopia"
- 再域名管理机构注册域名networkutopia.com
  - 向域名管理机构提供你的权威域名解析服务器的名字和IP地址
  - 域名管理机构向com顶级域名解析服务器中插入两条记录
    - 一条NS类型
    - 一条A类型
  - 在权威域名解析服务器中：
    - 为www.networkuptopia.com加入Type A记录
    - 为xxx@networkutopia.com加入Type MX记录、Type A记录

### FTP应用

> FTP：the file transfer protocol

- C/S架构
- ftp：RFC 959
- ftp server：port 21
  - 打开两个连接
  - TCP控制连接：21端口
  - TCP数据连接：20端口
  - 在传输完一个文件后，关闭TCP数据连接



































































