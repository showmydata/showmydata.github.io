---
layout: post
title: "2022春-计网-第20讲"
categories: 
  - Courses
tags:
  - 课程学习
  - 计算机网络
last_modified_at: 2022-04-29T22:10:52+08:00u
---

### Email应用

#### Email应用的构成

- 用户代理(邮件客户端)
  - 读、写Email消息
  - 与服务器交互，收、发Email消息
  - Outlook，Foxmail，Thunderbird
  - Web客户端

- 邮件服务器
  - 邮箱：存储发给该用户的Email
  - 消息队列：存储等待发送的Email
- SMTP协议
  - 邮件服务器之间传递消息所使用的协议
  - 客户端：发送消息的服务器
  - 服务器：接收消息的服务器

#### SMTP协议

- 使用TCP进行email消息的可靠传输
- 端口25
- 传输过程的三个阶段
  - 握手
  - 消息的传输
  - 关闭
- 命令/响应交互模式
  - 命令：ASCII文本
  - 响应：状态代码和语句
- Email消息只能包含7位ASCII码
- 使用持久性连接：连接一次，可发送多个文件，直至发送结束，关闭连接
- 利用CRLF.CRLF确定消息的结束
- 与HTTP对比：
  - HTTP：拉式(pull)，SMTP：退式(push)
  - 都是用命令/响应交互模式
  - 命令和状态代码都是ASCII码
  - HTTP：每个对象封装在独立的响应消息中
  - SMTP：多个对象在由多个部分构成的消息中发送

#### MIME：多媒体扩展

- 通过在邮件头部增加额外的行以声明MIME的内容类型
- MIME版本
- 数据编码方法
- 多媒体数据的类型，字类型及参数声明
- 编码后的数据，base64

#### 邮件访问协议

- 从服务器获取邮件
- POP协议
- IMAP协议
- HTTP协议

#### POP协议：Post Office Protocol

- 认证/授权(客户端<->服务器)和下载
- 认证过程
  - 客户端命令：User和Pass
  - 服务器响应：+OK和-ERR
- 事务阶段
  - List：列出消息数量
  - Retr：用编号获取消息
  - Dele：删除消息
  - Quit
- 模式
  - "下载并删除"：如果换了客户端软件，无法重读
  - "下载并保持"：不同客户端可以保留消息的拷贝
- POP3是无状态的

#### IMAP协议

- 所有消息统一保存在一个地方：服务器
- 允许用户利用文件夹组织消息
- IMAP支持跨会话的用户状态
  - 文件夹的名字
  - 文件夹与消息ID之间的映射等

### Web应用

#### Web与HTTP

- World Wide Web：网页互相连接
- 网页包含多个对象
  - 对象：HTML文件、JPEG图片、视频文件、动态脚本等
  - 基本HTML文件：包含对其它对象引用的链接
- 对象的寻址
  - URL：统一资源定位器
  - //host:port/path

#### HTTP协议概述

- 超文本传输协议HyperText Transfer Protocol
- C/S架构
  - 客户-Browser：请求、接收、展示Web对象
  - 服务器-Web Server：响应客户的请求，发送对象
- HTTP版本：
  - 1.0：RFC 1945
  - 1.1：RFC 2068
- 使用TCP传输服务
  - 服务器在80端口等待客户的请求
  - 浏览器发起到服务器的TCP连接（创建套接字Socket）
  - 服务器接收来自浏览器的TCP连接
  - 浏览器(HTTP客户端)与Web服务器(HTTP服务器)交换HTTP消息
  - 关闭TCP连接
- 无状态
  - 服务器不维护任何有关客户端过去所发请求的信息
- HTTP请求消息
  - ASCII：人直接可读
  - 上传输入的方法
    - POST方法：填写表格form；在请求消息的消息体中上传客户端的输入
    - URL方法：使用GET方法，输入信息通过request行的URL字段上传
  - 方法的类型
    - HTTP/1.0 
      - GET，POST；
      - HEAD：请server不要将所请求的对象放入响应消息中
    - HTTP/1.1
      - GET，POST，HEAD
      - PUT：将消息体中的文件上传到URL字段所指定的路径
      - DELETE：删除URL字段所指定的文件
- HTTP响应消息
  - 响应状态代码：第一行，200，400，404，505

#### HTTP/1.0 请求-响应过程

- HTTP/1.0
  - 每个TCP连接传输一个对象
  - 非持久性连接
- 过程
  - 用户输入URL：www.some.edu/sD/home.index
  - 1a.HTTP客户端向地址www.some.edu的服务器上的HTTP服务器进程（80端口）发起TCP连接请求
  - 1b. HTTP服务器在端口80等待TCP连接请求，接收连接并通知客户端
  - 2.HTTP客户端将HTTP请求消息（包含URL地址）通过TCP连接的套接字发出，消息中所含的URL表明客户端需要对象sD/home.index
  - 3.HTTP服务器收到请求消息，解析，产生包含所需对象的响应消息，并通过套接字发给客户端
  - 4.HTTP服务器关闭TCP连接
  - 5.HTTP客户端收到响应消息，解析html文件并显示，发现有若干个指向jpeg对象的超链接
  - 6.为每个jpeg对象重复步骤1~5

#### HTTP/1.1

- 响应时间分析
  - 发起、建立TCP连接：1个RTT
  - 发送HTTP请求消息到HTTP响应消息的前几个字节到达：1个RTT
  - 响应消息传输时间
  - 总响应时间 = (2RTT + 响应消息发送时间)/对象
- HTTP响应时间优化
  - 并行连接
  - 持久连接：每个TCP连接允许传输多个对象
  - 非流水持久连接：客户端只有收到前一个响应后才发送新的请求，每个被引用的对象耗时1个RTT
  - 流水的持久连接：只要遇到一个引用对象就尽快发出请求，理想情况下，收到所有引用对象只需1个RTT
  - HTTP/1.1版本默认使用流水的持久连接

#### HTTP/2

- HTTP/1.1连续请求多个大小不同的对象，会产生不公平，大文件占用时间过长的问题
- HTTP/1.1使用FCFS调度，顺序响应
  - 在大对象之后请求的小对象，需要等待大对象的传输
  - 若发生数据丢失会暂停对象传输

- HTTP/2：减少多对象请求的时延（响应时间）
  - 将对象分割为系列“帧”，不同对象的帧交替传输
  - 对象传输顺序基于客户定义的对象优先级（非FCFS调度）
  - 推送（push）客户未请求的对象

























